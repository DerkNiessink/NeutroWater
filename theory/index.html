<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/theory/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Theory and Methodology - Neutron Moderation MC</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Theory and Methodology";
        var mkdocs_page_input_path = "theory.md";
        var mkdocs_page_url = "/theory/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Neutron Moderation MC
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install_guide/">Quick Install Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../introduction/">Introduction</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Theory and Methodology</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-general-program-flow">1. General Program Flow</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-neutron-physics">2. Neutron Physics</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#21-initial-energy-spectrum">2.1 Initial Energy Spectrum</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#22-cross-sections">2.2 Cross Sections</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#23-distance-to-next-collision">2.3 Distance to Next Collision</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#24-neutron-interactions">2.4 Neutron Interactions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#25-handling-scattering-interaction">2.5 Handling Scattering Interaction</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#251-angular-distributions">2.5.1 Angular Distributions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#252-transforming-coordinates">2.5.2 Transforming Coordinates</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#26-thermal-motion">2.6 Thermal Motion</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-geometry">3 Geometry</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-monte-carlo-sampling">4 Monte Carlo Sampling</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#5-interpolation">5 Interpolation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#6-measuring-quantities">6 Measuring Quantities</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../results/">Results</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../user_guide/">User Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../references/">References</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Neutron Moderation MC</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Theory and Methodology</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="theory-and-methodology">Theory and Methodology</h1>
<h2 id="1-general-program-flow">1. General Program Flow</h2>
<p>The software conducts a collision-driven Monte Carlo simulation, where it simulates each particle individually. Prior to running the simulation, it must undergo initialization, which involves the following steps:</p>
<ul>
<li>Interpolating the total, absorbtion, and scattering cross section data.</li>
<li>Interpolating data of the initial energy distribution of the neutrons.</li>
<li>Sampling the initial neutron energies from the energy distribution.</li>
<li>Setting the initial position and energies of the neutrons.</li>
<li>Setting the position and size of the tank.</li>
</ul>
<p>The initial spectrum is discussed in <a href="./#21-initial-energy-spectrum">Initial Energy Spectrum</a>, the method of sampling from a distribution is described in <a href="./#3-monte-carlo-sampling">Monte Carlo Sampling</a>, and the interpolation of distributions in <a href="./#4-interpolation">Interpolation</a>. After the initializing, the actual simulation of the diffusing neutrons can start. Each neutron's energy and position is updated consecutively which consists of the following steps:</p>
<ol>
<li>Give the neutron a random direction.</li>
<li>Check if the neutron is inside the tank, if false end the loop else continue.</li>
<li>Get the total cross section corresponding to the current energy of the neutron. </li>
<li>Determine the nuclide with which the neutron collides.</li>
<li>Check if the the neutron has a thermal energy.</li>
<li>Compute the mean free path of the neutron and sample the distance to the next collision.</li>
<li>Determine the type of reaction. If it is absorption, end the loop; if it is elastic scattering, proceed.</li>
<li>Sample a direction from the angular distribution and compute the associated energy loss fraction. </li>
<li>Update the Neutron's position and energy.</li>
<li>Repeat steps 2-9 until the neutron either escaped or is absorbed.</li>
</ol>
<p>Each step is discussed in more detail in the following sections:</p>
<table>
<thead>
<tr>
<th>Steps</th>
<th>Section</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td><a href="./#2-geometry">Geometry</a></td>
</tr>
<tr>
<td>3-4</td>
<td><a href="./#11-cross-sections">Cross Sections</a></td>
</tr>
<tr>
<td>5</td>
<td><a href="./#26-thermal-motion">Thermal Motion</a></td>
</tr>
<tr>
<td>6</td>
<td><a href="./#13-distance-to-next-collision">Distance To Next Collision</a></td>
</tr>
<tr>
<td>7</td>
<td><a href="./#24-neutron-interactions">Neutron Interactions</a></td>
</tr>
<tr>
<td>8-9</td>
<td><a href="./#25-handling-scattering-interaction">Handling Scattering Interaction</a></td>
</tr>
</tbody>
</table>
<p>In the simulation, positions and energies of the neutrons are stored. Several properties can be computed and measured from this data post-simulation. The procedure of measuring these properties is described in <a href="#6-measuring-quantities">Measuring Quantities</a>.</p>
<h2 id="2-neutron-physics">2. Neutron Physics</h2>
<h3 id="21-initial-energy-spectrum">2.1 Initial Energy Spectrum</h3>
<p>The neutron source used is a mixture of americium-241 and beryllium-9. The following reactions take place in the source:</p>
<div class="arithmatex">\[\begin{equation} ^{241}_{95}\text{Am} \ \rightarrow \ ^{237}_{93}\text{Np} \ + \ ^4_2\text{He}, \end{equation}\]</div>
<div class="arithmatex">\[\begin{equation} ^4_2\text{He} \ + \ ^9_4\text{Be} \ \rightarrow \ ^{12}_6\text{C} \ + \ ^1_0\text{n}. \end{equation}\]</div>
<p>The first reaction involves the <span class="arithmatex">\( \alpha- \)</span> decay of the americium. The <span class="arithmatex">\( \alpha \)</span> particles have a probability of about <span class="arithmatex">\( 10^{-4}\)</span> to undergo fusion with the berylium, described by the second reaction. This reaction leads to the emmission of neutrons with energies between 3 and 10 MeV. We use the Am-Be energy spectrum (Figure 1) from the <a href="https://www.iso.org/standard/80060.html">ISO 8529-1</a> standard for sampling the initial energies of the neutrons.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/Am-Be-ISO-neutron-spectrum.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="ISO" src="../figures/Am-Be-ISO-neutron-spectrum.png" width="400" /></a>
  <figcaption><i>Figure 1: ISO neutron spectrum for Am-Be.</i></figcaption>
</figure>
<p></center></p>
<p>The neutron spectrum is interpolated to serve as a probability distribution of energies <span class="arithmatex">\( P(\text{Energy}) \)</span>. This interpolation and subsequent sampling follow the methodology described in <a href="#5-interpolation">Interpolation</a> and <a href="#4-monte-carlo-sampling">Monte Carlo Sampling</a> respectively. The interpolated initial neutron energy spectrum from the Am-Be source is shown in Figure 2.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/interpolated_neutron_spectrum.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="interpolated_spectrum" src="../figures/interpolated_neutron_spectrum.png" width="400" /></a>
  <figcaption><i>Figure 2: Interpolated ISO neutron spectrum for Am-Be.</i></figcaption>
</figure>
<p></center></p>
<h3 id="22-cross-sections">2.2 Cross Sections</h3>
<p>The cross section indicates the likelihood of a particular interaction occurring between two particles. It is influenced by two main factors: the types of particles involved and their energies. In our scenario, there are two possible combinations of particles in an interaction: a neutron with an H-nucleus and a neutron with an O-nucleus. Unfortunately, it's not possible to calculate the cross section as a function of energy analytically. However, there is an abundance of freely accessible nuclear data available to everyone. In the program, cross section data from <a href="https://www.nndc.bnl.gov/endf-b8.0/">ENDF/B</a> is used an interpolated following the procedure outlined in <a href="#5-interpolation">Interpolation</a>.</p>
<p>In various reactions, different cross sections are involved. To proceed, we employ the following notations:</p>
<p><center></p>
<table>
<thead>
<tr>
<th>Notation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="arithmatex">\(\sigma_{H, tot}, \sigma_{O, tot}\)</span></td>
<td>Total cross section for the specified nuclide.</td>
</tr>
<tr>
<td><span class="arithmatex">\(\sigma_{H, s}, \sigma_{O, s}\)</span></td>
<td>Scattering cross section for the specified nuclide.</td>
</tr>
<tr>
<td><span class="arithmatex">\(\sigma_{H, a}, \sigma_{O, a}\)</span></td>
<td>Absorption cross section for the specified nuclide.</td>
</tr>
<tr>
<td><span class="arithmatex">\(\Sigma_{H_2O}, \Sigma_{H}, \Sigma_{O}\)</span></td>
<td>Total macroscopic for the specified nuclide or molecule.</td>
</tr>
</tbody>
</table>
<p></center></p>
<p>The theory behind these reactions is described in detail in <a href="./#23-neutron-interactions">Neutron Interactions</a>. For each type of cross section and nuclide there are separate datafiles. Total macroscopic cross section for a molecule can be computed as follows:</p>
<div class="arithmatex">\[\begin{equation} \Sigma = \sum_i N_i \sigma_i, \end{equation}\]</div>
<p>where <span class="arithmatex">\(N_i\)</span> is the atomic density of atoms of type <span class="arithmatex">\(i\)</span>:</p>
<div class="arithmatex">\[\begin{equation} N_i = \frac{\rho N_a}{M} n_i, \end{equation}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the density of the compound, <span class="arithmatex">\(M\)</span> the molecular weight, <span class="arithmatex">\(N_a\)</span> Avogrado's constant, and <span class="arithmatex">\(n_i\)</span> the number of atoms of type <span class="arithmatex">\(i\)</span> in the molecule. Thus, the total macrocscopic cross section for <span class="arithmatex">\(H_2O\)</span> is given by:</p>
<div class="arithmatex">\[\begin{equation} \Sigma_{H_2O} = \frac{\rho_{H_20} N_a}{M_{H_20}} (2 \sigma_{H, t} + \sigma_{O, t}). \end{equation}\]</div>
<p>The cross sections in barns (<span class="arithmatex">\(10^{-28} m^2\)</span>) as a function of neutron energy for the O and H nuclide are shown in Figure 3 and 4.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/H_cross.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Hydrogen Cross Sections" src="../figures/H_cross.png" width="400" /></a>
  <figcaption><i>Figure 3: Hydrogen cross sections in barns at temperature T=300K.</i></figcaption>
</figure>
<figure>
  <a class="glightbox" href="../figures/O_cross.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/O_cross.png" width="400" /></a>
  <figcaption><i>Figure 4: Oxygen cross sections in barns at temperature T=300K.</i></figcaption>
</figure>
<p></center></p>
<h3 id="23-distance-to-next-collision">2.3 Distance to Next Collision</h3>
<p>The distance to the next collision <span class="arithmatex">\(l\)</span> follows a distribution function given by:</p>
<div class="arithmatex">\[\begin{equation} p(l)dl=\Sigma e^{-\Sigma l}dl, \end{equation}\]</div>
<p>where <span class="arithmatex">\(\Sigma\)</span> is the total macroscopic cross section of an arbitrary material. Integrating both sides to some distance <span class="arithmatex">\(l\)</span> gives:</p>
<div class="arithmatex">\[\begin{equation} \int_0^l dl'p(l') = 1 - e^{\Sigma l}. \end{equation}\]</div>
<p>As the probability distribution is normalized, we can set the this cummulative distribution to a uniformly distributed random 
number <span class="arithmatex">\(\xi\)</span> on the interval <span class="arithmatex">\( [0, 1) \)</span>. Isolating <span class="arithmatex">\(l \)</span> and using that in this case <span class="arithmatex">\(\Sigma \equiv \Sigma_{H_2O} \)</span>, gives us a formula for sampling the distance to the next collision:</p>
<div class="arithmatex">\[\begin{equation} l = - \lambda \ln{\xi}, \end{equation}\]</div>
<p>where <span class="arithmatex">\(\lambda \)</span> is the mean-free-path which is given by</p>
<div class="arithmatex">\[\begin{equation} \lambda = 1 / \Sigma_{H_2O}. \end{equation}\]</div>
<p>The mean-free-path as a function of neutron energy is shown in Figure 5.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/mean_free_path.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/mean_free_path.png" width="400" /></a>
  <figcaption><i>Figure 5: Mean-free-path in water as a function of neutron energy. </i></figcaption>
</figure>
<p></center></p>
<h3 id="24-neutron-interactions">2.4 Neutron Interactions</h3>
<p>To determine the type of reaction involving a nuclide, we initially identify which type of nuclide the neutron interacts with, either <span class="arithmatex">\( H\)</span> or <span class="arithmatex">\( O\)</span>. The probability of the neutron interacting with H is determined by:</p>
<div class="arithmatex">\[\begin{equation} P(H) = \frac{\Sigma_{H_2}}{\Sigma_{H_2O}} = \frac{2\sigma_{H,tot} }{2\sigma_{H, tot} + \sigma_{O, tot}}. \end{equation}\]</div>
<p>If <span class="arithmatex">\(\xi &lt; P(H)\)</span>, where <span class="arithmatex">\(\xi\)</span> is another uniformly distributed random number on the interval <span class="arithmatex">\( [0, 1) \)</span>, the neutron interacts with an <span class="arithmatex">\( H \)</span> nuclide; otherwise, it interacts with an <span class="arithmatex">\( O \)</span> nuclide. Since the cross sections depend on the energy of the neutron, <span class="arithmatex">\(P(H) \)</span> also varies accordingly. The dependence of <span class="arithmatex">\( P(H) \)</span> on neutron energy is depicted in Figure 6.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/H_probability.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/H_probability.png" width="400" /></a>
  <figcaption><i>Figure 6: Probability of H collision as a function of neutron energy. </i></figcaption>
</figure>
<p></center></p>
<p>Once the nuclide of interaction is determined, it is necessary to consider the reactions that can take place. Firstly we check absorbtion. The probability for absorbtion is given by:</p>
<div class="arithmatex">\[\begin{equation} P(\text{absorbtion}) = \frac{\sigma_{i,a}}{\sigma_{i,tot}}, \end{equation}\]</div>
<p>where <span class="arithmatex">\( \sigma_{i, tot} \)</span> and <span class="arithmatex">\( \sigma_{i, a} \)</span> are the total and absorbtion cross section of the previously identified nuclide respectively. Again, if <span class="arithmatex">\(\xi &lt; P(\text{absorbtion})\)</span>, then the neutron is absorbed by the nuclide. Absorption results in the complete dissipation of the neutron's energy and we proceed to simulate the next neutron. The absorption probability <span class="arithmatex">\(P(\text{absorbtion})\)</span> as a function of neutron energy for H and O are shown in Figure 7 and 8 respectively.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/H_absorbtion.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/H_absorbtion.png" width="400" /></a>
  <figcaption><i>Figure 7: Absorbtion probability of H as a function of neutron energy.</i></figcaption>
</figure>
<p></center></p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/O_absorbtion.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/O_absorbtion.png" width="400" /></a>
  <figcaption><i>Figure 8: Absorbtion probability of O as a function of neutron energy.</i></figcaption>
</figure>
<p></center></p>
<p>If the criteria mentioned above is not met, we consider a scattering interaction. This interaction leads to a reduction in the neutron's energy, determined by the outgoing angle. This angle is sampled from a distribution specific to the nuclide in question. The process of sampling the angle and computing the neutron's new direction and energy is elaborated upon in the Section <a href="./#25-handling-scattering-interaction">Handling Scattering Interaction</a>.</p>
<h3 id="25-handling-scattering-interaction">2.5 Handling Scattering Interaction</h3>
<p>A scattering interaction involving a neutron and nuclide results in an energy loss, which depends on the outgoing angle of the neutron. At lower (thermal) neutron energies, there is notable relative motion between the neutron and the nuclide. The treatment of this scenario is discussed in the Section <a href="./#26-thermal-motion">Thermal Motion</a>. However, at higher energies, it is a reasonable approximation to consider the nuclides as stationary. We can extract the outgoing angles from datasets containing angular distributions sourced from <a href="https://www.nndc.bnl.gov/endf-b8.0/">ENDF/B</a>. These distributions, which vary with increasing neutron energies, are defined by Legendre polynomials and are provided in the center-of-mass frame. The representation of these angular distributions using Legendre polynomials is detailed in the <a href="https://www.oecd-nea.org/dbdata/data/manual-endf/endf102.pdf">ENDF-6 Formats Manual</a>, which we will briefly explain in <a href="./#251-angular-distributions">Angular Distributions</a>. With this angle the new energy and direction of the neutron can be computed as described in <a href="./#252-transforming-coordinates">Transforming Coordinates</a>.</p>
<h4 id="251-angular-distributions">2.5.1 Angular Distributions</h4>
<p>The angular distributions depend on the energy <span class="arithmatex">\(E\)</span> in the labframe and the cosine of the outgoing angle in the center-of-mass frame <span class="arithmatex">\(\mu\)</span>. The distributions are normalized:</p>
<div class="arithmatex">\[\begin{equation} \int^1_{-1} f(\mu, E) d\mu = 1. \end{equation}\]</div>
<p>We assume that the angular distributions of the scattered neutrons have azimuthal symmetry. This implies that we can uniformly select the azimuthal angle <span class="arithmatex">\(\phi\)</span> from the range <span class="arithmatex">\( [0,2\pi) \)</span>. The distributions <span class="arithmatex">\( f(\mu, E) \)</span> are represented as Legendre polynomials:</p>
<div class="arithmatex">\[\begin{equation} f(\mu, E) =  \sum_{l=0}^{NL} \frac{2l+1}{2} a_l(E) P_l(\mu), \end{equation}\]</div>
<p>where <span class="arithmatex">\( l\)</span> is the order of the Legendre polynomial, <span class="arithmatex">\(a_l \)</span> the <span class="arithmatex">\(l^{th}\)</span> Legendre polynomial coefficient, and <span class="arithmatex">\( NL \)</span> the number of Legendre polynomials that represent the distribution. Below in Figure 9 and 10 the angular distributions are plotted for varying neutron energy.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/H_angular.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Hydrogen Cross Sections" src="../figures/H_angular.png" width="400" /></a>
  <figcaption><i>Figure 9: Hydrogen scattering angular distribution for varying energy.</i></figcaption>
</figure>
<figure>
  <a class="glightbox" href="../figures/O_angular.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Oxygen Cross Sections" src="../figures/O_angular.png" width="400" /></a>
  <figcaption><i>Figure 10: Oxygen scattering angular distribution for varying energy.</i></figcaption>
</figure>
<p></center></p>
<p>EXPLANATION ABOVE FIGURES</p>
<p>The neutron energy distributions are discretely spaced for each incoming neutron energy <span class="arithmatex">\(E_i \)</span>, requiring a selection between the distribution corresponding to the energy immediately above or below the current neutron energy. This is done by defining an interpolation factor:</p>
<div class="arithmatex">\[\begin{equation} f =  \frac{E - E_i}{E_{i+1} - E_i}, \end{equation}\]</div>
<p>where <span class="arithmatex">\( E \)</span> is the incoming energy of the neutron. We designate <span class="arithmatex">\(k\)</span> as the selected distribution index. If <span class="arithmatex">\( \xi &gt; f \)</span>, then <span class="arithmatex">\(k=i\)</span>; otherwise, <span class="arithmatex">\(k=i+1\)</span>, where <span class="arithmatex">\( \xi \)</span> is a uniform distributed random number on the interval <span class="arithmatex">\( [0, 1) \)</span>. The cosine of the scattering angle <span class="arithmatex">\(\mu \)</span> in the center-of-mass (CM) frame is sampled from the angular distribution corresponding to <span class="arithmatex">\(E_k\)</span>.</p>
<h4 id="252-transforming-coordinates">2.5.2 Transforming Coordinates</h4>
<p>From the cosine of the scattering angle in the CM frame <span class="arithmatex">\(\mu \)</span>, the secondary velocity of the neutron can be calculated analytically. We start by considering the velocity of the center-of-mass which is given by:</p>
<div class="arithmatex">\[\begin{equation} \mathbf{v}_{cm} = \frac{\mathbf{v}_n + A \mathbf{v}_t}{1+A} = \frac{\mathbf{v}_n}{1+A}, \end{equation}\]</div>
<p>where A is the mass of the target nuclide, <span class="arithmatex">\( \mathbf{v}_n \)</span> the initial velocity of the neutron, and <span class="arithmatex">\( \mathbf{v}_t \)</span> is the velocity of the target nuclide. For energies significantly surpassing thermal energy, <span class="arithmatex">\( \mathbf{v}_t \)</span> can be considered negligble. The velocity of the neutron can now be transformed to the CM frame:</p>
<div class="arithmatex">\[\begin{equation} \mathbf{V}_n = \mathbf{v}_n - \mathbf{v}_{cm}, \end{equation}\]</div>
<p>where the capital letter <span class="arithmatex">\( \mathbf{V} \)</span> denotes the CM frame. By expressing the pre- and post-collision direction in the CM frame as <span class="arithmatex">\( \mathbf{\Omega} = (u, v, w) \)</span> and <span class="arithmatex">\( \mathbf{\Omega}' = (u', v', w') \)</span> respectively, we can relate the pre- and post-collision components. The pre-collision direction of the neutron can be computed by dividing the magnitude of the velocity:</p>
<div class="arithmatex">\[\begin{equation} \mathbf{\Omega} = \frac{\mathbf{V}_n}{\mathbf{||V}_n||}.\end{equation}\]</div>
<p>The relation between the pre- and post-collision components is given by:</p>
<div class="arithmatex">\[\begin{equation}
\begin{aligned}  
    &amp;u' = \mu u + \frac{ \sqrt{1-\mu^2}(uw\cos{\phi} - v\sin{\phi}) }{ \sqrt{1-w^2} } \\
    &amp;v' = \mu v + \frac{ \sqrt{1-\mu^2}(vw\cos{\phi} - u\sin{\phi}) }{ \sqrt{1-w^2} } \\
    &amp;w'= \mu w - \sqrt{1-\mu^2}\sqrt{1-w^2}\cos{\phi},
\end{aligned}
\end{equation}\]</div>
<p>where <span class="arithmatex">\( \phi \)</span> is the azimuthal angle. We assume azimuthal symmetry, so <span class="arithmatex">\( \phi \)</span> can be sampled from a random uniformly distributed interval <span class="arithmatex">\( [0, 2\pi) \)</span>. Finally, transforming back to the lab frame results in the new velocity of the neutron:</p>
<div class="arithmatex">\[\begin{equation} \mathbf{v}'_n = ||\mathbf{V}_n|| \mathbf{\Omega}' + \mathbf{v}_{cm}. \end{equation}\]</div>
<p>The relation between the post- and pre-collision neutron energy in the labframe can be computed as</p>
<div class="arithmatex">\[\begin{equation} E' = \frac{||\mathbf{v}'_n||^2}{||\mathbf{v}_n||^2} E, \end{equation}\]</div>
<p>and the relation between the old and new position is given by:</p>
<div class="arithmatex">\[\begin{equation} \mathbf{r}'_n = \mathbf{r}_n + \mathbf{\Omega}' l,\end{equation}\]</div>
<p>where <span class="arithmatex">\( l \)</span> is obtained following the methodology outlined in <a href="#23-distance-to-next-collision">Distance to Next Collision</a>.</p>
<h3 id="26-thermal-motion">2.6 Thermal Motion</h3>
<p>When the energy of the neutron approaches thermal energies, the target nuclide cannot be assumed to be at rest. The target nucleus will have motion associated with its thermal vibration. Thermal motion has an effect on the cross sections and the secondary angular distribution. In <a href="https://docs.openmc.org/en/stable/index.html">The OpenMC Monte Carlo Code</a> a method is described for sampling the velocity of the target nucleus to be used in the elastic scattering kinematic equations described in <a href="#25-handling-scattering-interaction">Handling Scattering Interaction</a>. </p>
<p>For the activation process we are mainly interested in the high energy neutrons. For simplicity in the simulation, thermal neutron energies are drawn from a Maxwell-Boltzmann distribution. Furthermore, the resulting direction of a neutron from a scattering reaction is chosen to be random. A neutron is considered thermal when it reaches an energy below the threshold of <span class="arithmatex">\( 10 K_B T \approx 0.252 \ eV\)</span>, where <span class="arithmatex">\( K_B \)</span> is Boltzmann's constant and <span class="arithmatex">\(T \)</span> is the temperature of the water. The Maxwell-Boltzmann distribution for <span class="arithmatex">\( T = 293 K \)</span> is used in the simulation and shown in Figure 11.</p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/boltzmann.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Maxwell" src="../figures/boltzmann.png" width="400" /></a>
  <figcaption><i>Figure 11: Maxwell-Boltzmann distribution of energies for T = 293 K. The thermal energy threshold used in the simulation is shown with the dashed line. </i></figcaption>
</figure>
<p></center></p>
<h2 id="3-geometry">3 Geometry</h2>
<p>The geometry of the experiment is shown in Figure 12. In the simulation the neutron source is placed at the origin. The water tank of radius <span class="arithmatex">\( R\)</span> and height <span class="arithmatex">\( h \)</span> is placed at position <span class="arithmatex">\( \mathbf{r}_t\)</span> such that the neutrons diffuse from the correct initial position. </p>
<p><center></p>
<figure>
  <a class="glightbox" href="../figures/tank.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Maxwell" src="../figures/tank.png" width="250" /></a>
  <figcaption><i>Figure 12: Simplified figure of the neutron source in the water tank. The insert containing the target can be moved in the radial direction through slots in the top plate of the water tank. </i></figcaption>
</figure>
<p></center></p>
<p>A Neutron at position <span class="arithmatex">\( \mathbf{r}_n \)</span> is inside the tank if the following conditions are true:</p>
<div class="arithmatex">\[\begin{equation} 
\begin{aligned}
&amp; |\mathbf{r}_n - \mathbf{r}_t |_{xy} &lt; R  \\
&amp; |r_{n_z} - r_{t_z} | &lt; h/2,  \\
\end{aligned}
\end{equation}\]</div>
<p>where the notation <span class="arithmatex">\( | \mathbf{r} |_{xy} = \sqrt{r_x^2 + r_y^2} \)</span> is used. If these conditions are not met, the neutron is flagged as escaped and the simulation proceeds with simulating the next neutron.</p>
<h2 id="4-monte-carlo-sampling">4 Monte Carlo Sampling</h2>
<p>In the initilization the energies of the neutrons are sampled from the distribution shown in Figure 2. The secondary angles of the neutrons in a scattering interaction are sampled from angular distributions on the fly. Some examples of these angular distributions are shown in Figure 10. Finally, when a neutron reaches the thermal energy threshold, its energies are sampled from the Boltzmann distribution shown in Figure 11. The Monte Carlo method used in the simulation is rejection sampling. For simplicity, the proposal distribution is chosen to be a uniform distribution on the interval <span class="arithmatex">\([0, 1) \)</span> for each of the sampling processes. </p>
<h2 id="5-interpolation">5 Interpolation</h2>
<h2 id="6-measuring-quantities">6 Measuring Quantities</h2>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../introduction/" class="btn btn-neutral float-left" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../results/" class="btn btn-neutral float-right" title="Results">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../introduction/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../results/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>
